# CLAUDE.md — CLMandarin

## Project Overview

Offline-first HSK 1-6 Mandarin flashcard web app. Users browse vocab, create custom lists, and study with flashcards. All data stored locally (IndexedDB). PWA for offline use.

## Tech Stack

- **Vite + React + TypeScript** — frontend framework
- **TailwindCSS** — styling (utility classes, no CSS modules)
- **Dexie.js** — IndexedDB wrapper for local storage
- **vite-plugin-pwa** — service worker & PWA manifest
- **@dnd-kit/core** — drag-and-drop for list reordering
- **Cheerio** — HTML parsing for scraper (dev dependency)

## Commands

```bash
npm run dev          # Start dev server
npm run build        # Production build
npm run preview      # Preview production build
npm run scrape       # Run vocab scraper → public/data/hsk-*.json
npm run lint         # ESLint
npm run typecheck    # tsc --noEmit
```

## Architecture

- Vocab data lives in `public/data/hsk-{1-6}.json` (static, generated by scraper)
- On first app load, vocab JSON is fetched and cached in IndexedDB
- User flashcard lists are stored in IndexedDB (Dexie.js)
- File import/export uses JSON files with `.clmandarin.json` extension
- PWA service worker precaches all static assets including vocab JSON

## Key Patterns

- **Hooks for data access**: `useVocab()`, `useLists()`, `useFileIO()` — all DB operations go through hooks
- **No backend** (Phase 1): Everything is client-side. No API calls except initial vocab fetch from static files.
- **IDs**: Vocab words use `hsk{level}-{number}` format (e.g., `hsk1-042`). Lists use UUIDs.
- **File format**: Export includes both list metadata and denormalized word data for portability.

## Conventions

- Functional components only, no class components
- Named exports (no default exports)
- Tailwind for all styling — no inline styles or CSS files
- Keep components small — extract when a component exceeds ~100 lines
- Types live in `src/types/index.ts`; import from there

## Data Model

```typescript
interface VocabWord {
  id: string;           // "hsk1-042"
  hskLevel: number;     // 1-6
  number: number;       // position in HSK level
  hanzi: string;
  pinyin: string;
  english: string;
}

interface FlashcardList {
  id: string;           // UUID
  name: string;
  description?: string;
  createdAt: number;
  updatedAt: number;
  wordIds: string[];    // ordered VocabWord ids
}
```

## Scraper Notes

- Source: `https://mandarinbean.com/hsk-{1-6}-vocabulary-list/`
- HTML selector: `figure.wp-block-table table tbody tr`
- Skip category header rows in HSK 1 (empty first cell + `<strong>` in second)
- Strip `&nbsp;` from pinyin, decode HTML entities
- Output: one JSON file per level in `public/data/`
